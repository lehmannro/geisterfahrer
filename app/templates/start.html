<!DOCTYPE HTML>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Start</title>
</head>
<body>
  <a href="javascript:doit();">do it!</a>
  <br/>
<script type="text/javascript" charset="utf-8">
function cb(position) {
  var lat = position.coords.latitude;
  var lon = position.coords.longitude;

  var client = new XMLHttpRequest();
  client.open("POST", "/new");
  client.send("lat="+lat+"&lon="+lon);
  client.onreadystatechange = cb2;
}

function cb2() 
{
	//alert(this.responseXML);
	if(this.readyState == this.DONE){
		alert('your street: ' + this.responseText);
	}
}

function err(e) {
  document.write("Failed. :(<br/>");
  document.write("<br/><b>code:</b> " + e.code);
  document.write("<br/><b>message:</b> " + e.message);
  document.write("<hr>");
}
function doit() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(cb, err);
  }
  else {
    document.write("No navigator.location!");
  }
}
</script>
</body>
</html>
